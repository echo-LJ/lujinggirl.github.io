<!DOCTYPE html>
<html lang>
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Echo">



    <meta name="description" content="blog">



<title>使用react搭建组件库：react+typescript+storybook | Echo的博客</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Echo&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Echo&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">使用react搭建组件库：react+typescript+storybook</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Echo</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">June 1, 2020&nbsp;&nbsp;10:00:00</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <meta name="referrer" content="no-referrer">

<h2 id="一、-安装组件库"><a href="#一、-安装组件库" class="headerlink" title="一、 安装组件库"></a>一、 安装组件库</h2><p>执行安装命令<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx create-react-app echo-rui  --typescript</span><br></pre></td></tr></table></figure></p>
<h2 id="二、-组件库配置eslint"><a href="#二、-组件库配置eslint" class="headerlink" title="二、 组件库配置eslint"></a>二、 组件库配置eslint</h2><ul>
<li>配置ESlint<br>新建<code>.eslintrc.json</code>文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;extends&quot;: &quot;react-app&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>新建 <code>.vscode/settings.json</code>文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;eslint.validate&quot;: [</span><br><span class="line">    &quot;javascript&quot;,</span><br><span class="line">    &quot;javascriptreact&quot;,</span><br><span class="line">    &#123; &quot;language&quot;: &quot;typescript&quot;, &quot;autoFix&quot;: true &#125;,</span><br><span class="line">    &#123; &quot;language&quot;: &quot;typescriptreact&quot;, &quot;autoFix&quot;: true &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="三、-引入依赖"><a href="#三、-引入依赖" class="headerlink" title="三、 引入依赖"></a>三、 引入依赖</h2><p>在组件中使用 <code>classname</code>：<a href="https://github.com/jedWatson/classnames" target="_blank" rel="noopener">https://github.com/jedWatson/classnames</a><br>执行安装命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install classnames -D</span><br><span class="line">npm install @types/classnames -D</span><br><span class="line">npm install node-sass -D</span><br></pre></td></tr></table></figure></p>
<p>使用方法示例：<br>如果对象的key值是变化的，可以采用下面的中括号的形式：[<code>btn-${btnType}</code>]<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// btn, btn-lg, btn-primary</span><br><span class="line">const classes = classNames(&apos;btn&apos;, className, &#123;</span><br><span class="line">   [`btn-$&#123;btnType&#125;`]: btnType,</span><br><span class="line">   [`btn-$&#123;size&#125;`]: size,</span><br><span class="line">   &apos;disabled&apos;: (btnType === &apos;link&apos;) &amp;&amp; disabled</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h2 id="四、-编写组件"><a href="#四、-编写组件" class="headerlink" title="四、 编写组件"></a>四、 编写组件</h2><ul>
<li>新建 <code>src/components/Button/button.tsx</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">import React,&#123;FC,ButtonHTMLAttributes,AnchorHTMLAttributes&#125; from &quot;react&quot;;</span><br><span class="line">import classnames from &quot;classnames&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 按钮大小</span><br><span class="line">export type ButtonSize = &quot;lg&quot; | &quot;sm&quot;;</span><br><span class="line"></span><br><span class="line">export type ButtonType = &quot;primary&quot; | &quot;default&quot; | &quot;danger&quot; | &quot;link&quot;;</span><br><span class="line"></span><br><span class="line">interface BaseButtonProps &#123;</span><br><span class="line">  /** 自定义类名 */</span><br><span class="line">  className?: string;</span><br><span class="line">  /** 设置Button 的禁用 */</span><br><span class="line">  disabled?: boolean;</span><br><span class="line">  /** 设置Button 的大小 */</span><br><span class="line">  size?: ButtonSize;</span><br><span class="line">  /** 设置Button 的类型 */</span><br><span class="line">  btnType?: ButtonType;</span><br><span class="line">  children: React.ReactNode;</span><br><span class="line">  /** 当btnType为link时，必填 */</span><br><span class="line">  href?: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 并集</span><br><span class="line">type NativeButtonProps = BaseButtonProps &amp;</span><br><span class="line">  ButtonHTMLAttributes&lt;HTMLElement&gt;;</span><br><span class="line">type AnchorButtonProps = BaseButtonProps &amp;</span><br><span class="line">  AnchorHTMLAttributes&lt;HTMLElement&gt;;</span><br><span class="line"></span><br><span class="line">// Partial：typescript全局函数，将属性全部变成可选的</span><br><span class="line">export type ButtonProps = Partial&lt;NativeButtonProps &amp; AnchorButtonProps&gt;;</span><br><span class="line"></span><br><span class="line">// 使用react-docgen-typescript-loader的bug，只能使用FC，不能React.FC</span><br><span class="line">export const Button: FC&lt;ButtonProps&gt; = (props) =&gt; &#123;</span><br><span class="line">  const &#123;</span><br><span class="line">    disabled,</span><br><span class="line">    size,</span><br><span class="line">    btnType,</span><br><span class="line">    children,</span><br><span class="line">    href,</span><br><span class="line">    className,</span><br><span class="line">    ...resetProps</span><br><span class="line">  &#125; = props;</span><br><span class="line"></span><br><span class="line">  const classes = classnames(&quot;echo-btn&quot;, className, &#123;</span><br><span class="line">    [`echo-btn-$&#123;btnType&#125;`]: btnType,</span><br><span class="line">    [`echo-btn-$&#123;size&#125;`]: size,</span><br><span class="line">    &quot;echo-button-disabled&quot;: btnType === &quot;link&quot; &amp;&amp; disabled,</span><br><span class="line">  &#125;);</span><br><span class="line">  if (btnType === &quot;link&quot; &amp;&amp; href) &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;a href=&#123;href&#125; className=&#123;classes&#125; &#123;...resetProps&#125;&gt;</span><br><span class="line">        &#123;children&#125;</span><br><span class="line">      &lt;/a&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;button className=&#123;classes&#125; disabled=&#123;disabled&#125; &#123;...resetProps&#125;&gt;</span><br><span class="line">        &#123;children&#125;</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Button.defaultProps = &#123;</span><br><span class="line">  disabled: false,</span><br><span class="line">  btnType: &quot;default&quot;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default Button;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>新建 <code>src/components/Button/index.tsx</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import Button from &quot;./button&quot;;</span><br><span class="line"></span><br><span class="line">export default Button;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 <code>src/components/Button/_style.scss</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">@import &quot;../../styles/variables/button&quot;;</span><br><span class="line">@import &quot;../../styles/mixin/button&quot;;</span><br><span class="line">.echo-btn &#123;</span><br><span class="line">  position: relative;</span><br><span class="line">  display: inline-block;</span><br><span class="line">  font-weight: $btn-font-weight;</span><br><span class="line">  line-height: $btn-line-height;</span><br><span class="line">  color: $body-color;</span><br><span class="line">  white-space: nowrap;</span><br><span class="line">  text-align: center;</span><br><span class="line">  vertical-align: middle;</span><br><span class="line">  background-image: none;</span><br><span class="line">  border: $btn-border-width solid transparent;</span><br><span class="line">  @include button-size(</span><br><span class="line">    $btn-padding-y,</span><br><span class="line">    $btn-padding-x,</span><br><span class="line">    $btn-font-size,</span><br><span class="line">    $btn-border-radius</span><br><span class="line">  );</span><br><span class="line">  box-shadow: $btn-box-shadow;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">  transition: $btn-transition;</span><br><span class="line">  &amp;.echo-button-disabled</span><br><span class="line">  &amp;[disabled] &#123;</span><br><span class="line">    cursor: not-allowed;</span><br><span class="line">    opacity: $btn-disabled-opacity;</span><br><span class="line">    box-shadow: none;</span><br><span class="line">    &gt; * &#123;</span><br><span class="line">      pointer-events: none;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.echo-btn-lg &#123;</span><br><span class="line">  @include button-size(</span><br><span class="line">    $btn-padding-y-lg,</span><br><span class="line">    $btn-padding-x-lg,</span><br><span class="line">    $btn-font-size-lg,</span><br><span class="line">    $btn-border-radius-lg</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.echo-btn-sm &#123;</span><br><span class="line">  @include button-size(</span><br><span class="line">    $btn-padding-y-sm,</span><br><span class="line">    $btn-padding-x-sm,</span><br><span class="line">    $btn-font-size-sm,</span><br><span class="line">    $btn-border-radius-sm</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.echo-btn-primary &#123;</span><br><span class="line">  @include button-style($primary, $primary, $white);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.echo-btn-danger &#123;</span><br><span class="line">  @include button-style($danger, $danger, $white);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.echo-btn-default &#123;</span><br><span class="line">  @include button-style(</span><br><span class="line">    $white,</span><br><span class="line">    $gray-400,</span><br><span class="line">    $body-color,</span><br><span class="line">    $white,</span><br><span class="line">    $primary,</span><br><span class="line">    $primary</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.echo-btn-link &#123;</span><br><span class="line">  font-weight: $font-weight-normal;</span><br><span class="line">  color: $btn-link-color;</span><br><span class="line">  text-decoration: $link-decoration;</span><br><span class="line">  box-shadow: none;</span><br><span class="line">  &amp;:hover &#123;</span><br><span class="line">    color: $btn-link-hover-color;</span><br><span class="line">    text-decoration: $link-hover-decoration;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;:focus &#123;</span><br><span class="line">    text-decoration: $link-hover-decoration;</span><br><span class="line">    box-shadow: none;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;:disabled,</span><br><span class="line">  &amp;.echo-button-disabled &#123;</span><br><span class="line">    color: $btn-link-disabled-color;</span><br><span class="line">    pointer-events: none;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 <code>styles/variables/button.scss</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@import &quot;./common&quot;;</span><br><span class="line">// 按钮基本属性</span><br><span class="line">$btn-font-weight: 400;</span><br><span class="line">$btn-padding-y: 0.375rem !default;</span><br><span class="line">$btn-padding-x: 0.75rem !default;</span><br><span class="line">$btn-font-family: $font-family-base !default;</span><br><span class="line">$btn-font-size: $font-size-base !default;</span><br><span class="line">$btn-line-height: $line-height-base !default;</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 styles/mixin/button.scss`文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@mixin button-size($padding-y, $padding-x, $font-size, $border-raduis) &#123;</span><br><span class="line">  padding: $padding-y $padding-x;</span><br><span class="line">  font-size: $font-size;</span><br><span class="line">  border-radius: $border-raduis;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@mixin button-style(</span><br><span class="line">  $background,</span><br><span class="line">  $border,</span><br><span class="line">  $color,</span><br><span class="line">  // lghten,sass内置函数，比$background颜色要浅上7.5%</span><br><span class="line">    $hover-background: lighten($background, 7.5%),</span><br><span class="line">  $hover-border: lighten($border, 10%),</span><br><span class="line">  $hover-color: $color</span><br><span class="line">) </span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 <code>src/styles/index.scss</code>文件中引入组件样式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// index文件主要是引入所有组件的样式。</span><br><span class="line">// 不需要写_，这是sass的一种写法，告诉sass这些样式不打包到css中，只能做导入，也是一种模块化</span><br><span class="line"></span><br><span class="line">// 按钮样式</span><br><span class="line">@import &quot;../components/Button/style&quot;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 <code>src/styles/index.scss</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// index文件主要是引入所有组件的样式。</span><br><span class="line">// 不需要写_，这是sass的一种写法，告诉sass这些样式不打包到css中，只能做导入，也是一种模块化</span><br><span class="line"></span><br><span class="line">// 按钮样式</span><br><span class="line">@import &quot;../components/Button/style&quot;;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="五、-删除多余文件-引用组件"><a href="#五、-删除多余文件-引用组件" class="headerlink" title="五、 删除多余文件+引用组件"></a>五、 删除多余文件+引用组件</h2><ul>
<li>删除<code>src/App.css</code> + <code>src/logo.svg</code> + <code>src/index.css</code> + <code>src/App.test.js</code> + <code>serviceWorker.ts</code>文件</li>
<li><p>修改<code>App.tsx</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import &quot;./styles/index.scss&quot;;</span><br><span class="line">import Button, &#123; ButtonType, ButtonSize &#125; from &quot;./components/Button/button&quot;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div className=&quot;App&quot;&gt;</span><br><span class="line">      &lt;Button&gt;hello&lt;/Button&gt;</span><br><span class="line">      &lt;Button disabled&gt;hello&lt;/Button&gt;</span><br><span class="line">      &lt;Button btnType=&quot;primary&quot; size=&quot;sm&quot;&gt;</span><br><span class="line">        hello</span><br><span class="line">      &lt;/Button&gt;</span><br><span class="line">      &lt;Button</span><br><span class="line">        btnType=&quot;danger&quot;</span><br><span class="line">        size=&quot;lg&quot;</span><br><span class="line">        onClick=&#123;() =&gt; &#123;</span><br><span class="line">          alert(111);</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        hello</span><br><span class="line">      &lt;/Button&gt;</span><br><span class="line">     &lt;Button</span><br><span class="line">        btnType=&quot;link&quot;</span><br><span class="line">        href=&quot;http://www.baidu.com&quot;</span><br><span class="line">        target=&quot;_blank&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        hello</span><br><span class="line">      &lt;/Button&gt;</span><br><span class="line">      &lt;Button disabled btnType=&quot;link&quot; href=&quot;http://www.baidu.com&quot;&gt;</span><br><span class="line">        hello</span><br><span class="line">      &lt;/Button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改<code>src/index.tsx</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export &#123; default as Button &#125; from &quot;./components/Button&quot;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="六、-运行项目"><a href="#六、-运行项目" class="headerlink" title="六、 运行项目"></a>六、 运行项目</h2><p>执行命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure></p>
<p>访问项目 可以看到button组件成功了！<br><img src="https://upload-images.jianshu.io/upload_images/11846892-8690603021ebd620.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h2 id="七、单元测试"><a href="#七、单元测试" class="headerlink" title="七、单元测试"></a>七、单元测试</h2><p>新建<code>src/Button/button.test.tsx</code>文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import &#123; render, fireEvent &#125; from &quot;@testing-library/react&quot;;</span><br><span class="line">import Button, &#123; ButtonProps &#125; from &quot;./button&quot;;</span><br><span class="line"></span><br><span class="line">describe(&quot;Button 组件&quot;, () =&gt; &#123;</span><br><span class="line">  it(&apos;默认Button&apos;, () =&gt; &#123;</span><br><span class="line">    const testProps: ButtonProps = &#123;</span><br><span class="line">      onClick: jest.fn(),</span><br><span class="line">    &#125;</span><br><span class="line">    const wrapper = render(&lt;Button &#123;...testProps&#125;&gt;hello&lt;/Button&gt;);</span><br><span class="line">    const element = wrapper.getByText(&apos;hello&apos;)as HTMLButtonElement;</span><br><span class="line">    // 元素是否被渲染在文档中</span><br><span class="line">    expect(element).toBeInTheDocument();</span><br><span class="line">    // 判断标签名</span><br><span class="line">    expect(element.tagName).toEqual(&quot;BUTTON&quot;);</span><br><span class="line">     // 判断是否有类名</span><br><span class="line">     expect(element).toHaveClass(&quot;echo-btn-default&quot;);</span><br><span class="line">     expect(element).not.toHaveClass(&quot;echo-disabled&quot;);</span><br><span class="line">     //   触发点击事件</span><br><span class="line">    fireEvent.click(element);</span><br><span class="line">    expect(testProps.onClick).toHaveBeenCalled();</span><br><span class="line">    expect(element.disabled).toBeFalsy();</span><br><span class="line">  &#125;)</span><br><span class="line">  it(&quot;测试传入不同属性的情况&quot;, () =&gt; &#123;</span><br><span class="line">    const testProps: ButtonProps = &#123;</span><br><span class="line">      btnType: &quot;primary&quot;,</span><br><span class="line">      size: &quot;lg&quot;,</span><br><span class="line">      className: &quot;test-name&quot;,</span><br><span class="line">    &#125;;</span><br><span class="line">    const wrapper = render(&lt;Button &#123;...testProps&#125;&gt;hello&lt;/Button&gt;);</span><br><span class="line">    const element = wrapper.getByText(&quot;hello&quot;) as HTMLButtonElement;</span><br><span class="line">    expect(element).toBeInTheDocument();</span><br><span class="line">    expect(element).toHaveClass(&quot;echo-btn-primary&quot;);</span><br><span class="line">    expect(element).toHaveClass(&quot;echo-btn-lg&quot;);</span><br><span class="line">    expect(element).toHaveClass(&quot;test-name&quot;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;测试当btnType为link和href存在的情况&quot;, () =&gt; &#123;</span><br><span class="line">    const testProps: ButtonProps = &#123;</span><br><span class="line">      btnType: &quot;link&quot;,</span><br><span class="line">      href: &quot;http://www.baidu.com&quot;,</span><br><span class="line">    &#125;;</span><br><span class="line">    const wrapper = render(&lt;Button &#123;...testProps&#125;&gt;Link&lt;/Button&gt;);</span><br><span class="line">    const element = wrapper.getByText(&quot;Link&quot;) as HTMLAnchorElement;</span><br><span class="line">    expect(element).toBeInTheDocument();</span><br><span class="line">    expect(element.tagName).toEqual(&quot;A&quot;);</span><br><span class="line">    expect(element).toHaveClass(&quot;echo-btn-link&quot;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(&quot;测试禁用的情况&quot;, () =&gt; &#123;</span><br><span class="line">    const testProps: ButtonProps = &#123;</span><br><span class="line">      onClick: jest.fn(),</span><br><span class="line">      disabled: true,</span><br><span class="line">    &#125;;</span><br><span class="line">    const wrapper = render(&lt;Button &#123;...testProps&#125;&gt;Disabled&lt;/Button&gt;);</span><br><span class="line">    const element = wrapper.getByText(&quot;Disabled&quot;) as HTMLButtonElement;</span><br><span class="line">    expect(element).toBeInTheDocument();</span><br><span class="line">    expect(element.disabled).toBeTruthy();</span><br><span class="line">    fireEvent.click(element);</span><br><span class="line">    expect(testProps.onClick).not.toHaveBeenCalled();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>执行命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm test</span><br></pre></td></tr></table></figure></p>
<p>可以看到单元测试成功通过！<br><img src="https://upload-images.jianshu.io/upload_images/11846892-04f6282ff0e82886.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h2 id="八、组件库实现按需加载"><a href="#八、组件库实现按需加载" class="headerlink" title="八、组件库实现按需加载"></a>八、组件库实现按需加载</h2><ul>
<li><p>安装依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$npm install node-cmd -D</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 <code>buildScss.js</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">const cmd = require(&quot;node-cmd&quot;);</span><br><span class="line">const path = require(&quot;path&quot;);</span><br><span class="line">const fs = require(&quot;fs&quot;);</span><br><span class="line">const entryDir = path.resolve(__dirname, &quot;./src/components&quot;);</span><br><span class="line">const outputDir = path.resolve(__dirname, &quot;./dist/components&quot;);</span><br><span class="line">function getScssEntry() &#123;</span><br><span class="line">  let entryMap = &#123;&#125;;</span><br><span class="line">  fs.readdirSync(entryDir).forEach(function (pathName) &#123;</span><br><span class="line">    const entryName = path.resolve(entryDir, pathName);</span><br><span class="line">    const outputName = path.resolve(outputDir, pathName);</span><br><span class="line">    let entryFileName = path.resolve(entryName, &quot;_style.scss&quot;);</span><br><span class="line">    let outputFileName = path.resolve(outputName, &quot;style/index.css&quot;);</span><br><span class="line"></span><br><span class="line">    entryMap[pathName] = &#123;&#125;;</span><br><span class="line">    entryMap[pathName].entry = entryFileName;</span><br><span class="line">    entryMap[pathName].output = outputFileName;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return entryMap;</span><br><span class="line">&#125;</span><br><span class="line">const entry = getScssEntry();</span><br><span class="line">let buildArr = [];</span><br><span class="line">for (const key in entry) &#123;</span><br><span class="line">  const promise = new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    cmd.get(`npx node-sass $&#123;entry[key].entry&#125; $&#123;entry[key].output&#125;`, function (</span><br><span class="line">      err,</span><br><span class="line">      data,</span><br><span class="line">      stderr</span><br><span class="line">    ) &#123;</span><br><span class="line">      if (err) &#123;</span><br><span class="line">        reject(err);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      console.log(&quot;the current working dir is : &quot;, data);</span><br><span class="line">      fs.writeFileSync(</span><br><span class="line">        path.join(__dirname, `./dist/components/$&#123;key&#125;/style/css.js`),</span><br><span class="line">        &quot;import &apos;./index.css&apos;&quot;</span><br><span class="line">      );</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  buildArr.push(promise);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Promise.all(buildArr)</span><br><span class="line">  .then(() =&gt; &#123;</span><br><span class="line">    console.log(&quot;build success&quot;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch((e) =&gt; &#123;</span><br><span class="line">    console.log(e);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 <code>_babel.config.js</code>文件<br>libraryName:需要加载的库，我这里的是echo-rui<br>libraryDirectory：需要加载的组件库所在的目录，当前的组件是存放在dist/components下的<br>style：加载的css类型，当前项目只有css，没有less，所以这里写css即可，如需配置less,请看注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  presets: [&quot;react-app&quot;],</span><br><span class="line">  plugins: [</span><br><span class="line">    [</span><br><span class="line">      &quot;import&quot;,</span><br><span class="line">      &#123;</span><br><span class="line">        libraryName: &quot;echo-rui&quot;, </span><br><span class="line">        camel2DashComponentName: false, // 是否需要驼峰转短线</span><br><span class="line">        camel2UnderlineComponentName: false, // 是否需要驼峰转下划线</span><br><span class="line">        libraryDirectory: &quot;dist/components&quot;,</span><br><span class="line">        style: &quot;css&quot;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">    // [&quot;import&quot;, &#123;</span><br><span class="line">    //   &quot;libraryName&quot;: &quot;antd&quot;,</span><br><span class="line">    //   &quot;libraryDirectory&quot;: &quot;es&quot;,</span><br><span class="line">    //   &quot;style&quot;: &quot;css&quot; // `style: true` 会加载 less 文件</span><br><span class="line">    // &#125;]</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>⚠️⚠️⚠️重要说明：在开发的时候，每个组件目录下面必须有一个<code>_style.scss</code>样式文件，即使他是个空文件也必须有，否则会在按需引入的时候报错找不到css文件⚠️⚠️</p>
<h2 id="九、storybook文档生成"><a href="#九、storybook文档生成" class="headerlink" title="九、storybook文档生成"></a>九、storybook文档生成</h2><ol>
<li><p>初始化storyBook</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx -p @storybook/cli sb init</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加依赖和插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @storybook/addon-info --save-dev</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加npm脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">   ...</span><br><span class="line">   &quot;storybook&quot;: &quot;start-storybook -p 9009 -s public&quot;,</span><br><span class="line">   &quot;build-storybook&quot;: &quot;build-storybook -s public&quot;</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置storybook，支持typescript</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install react-docgen-typescript-loader -D</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加storybook配置文件</p>
</li>
</ol>
<ul>
<li><p>新建<code>.storybook/webpack.config.js</code>文件<br><code>shouldExtractLiteralValuesFromEnum</code>：storybook爬取组件属性的时候会自动把type类型的属性自动展开。<br><code>propFilter</code>：过滤掉不需要爬取的属性的来源。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">module.exports = (&#123; config &#125;) =&gt; &#123;</span><br><span class="line">  config.module.rules.push(&#123;</span><br><span class="line">    test: /\.tsx?$/,</span><br><span class="line">    use: [</span><br><span class="line">      &#123;</span><br><span class="line">        loader: require.resolve(&quot;babel-loader&quot;),</span><br><span class="line">        options: &#123;</span><br><span class="line">          presets: [require.resolve(&quot;babel-preset-react-app&quot;)]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, </span><br><span class="line">      &#123;</span><br><span class="line">        loader: require.resolve(&quot;react-docgen-typescript-loader&quot;),</span><br><span class="line">        options: &#123;</span><br><span class="line">          shouldExtractLiteralValuesFromEnum: true,</span><br><span class="line">          propFilter: (prop) =&gt; &#123;</span><br><span class="line">            if (prop.parent) &#123;</span><br><span class="line">              return !prop.parent.fileName.includes(&apos;node_modules&apos;)</span><br><span class="line">            &#125;</span><br><span class="line">            return true            </span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  config.resolve.extensions.push(&quot;.ts&quot;, &quot;.tsx&quot;);</span><br><span class="line"></span><br><span class="line">  return config;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建<code>.storybook/style.scss</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// 这个文件主要是对storybook文档样式的配置</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建<code>.storybook/config.tsx</code>文件<br>配置插件以及需要加载的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import &#123; configure,addDecorator,addParameters &#125; from &apos;@storybook/react&apos;;</span><br><span class="line">import &#123; withInfo &#125; from &apos;@storybook/addon-info&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import &apos;../src/styles/index.scss&apos;</span><br><span class="line">import &apos;./style.scss&apos;</span><br><span class="line">import React from &apos;react&apos;</span><br><span class="line"></span><br><span class="line">const wrapperStyle: React.CSSProperties = &#123;</span><br><span class="line">  padding: &apos;20px 40px&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const storyWrapper = (stroyFn: any) =&gt; (</span><br><span class="line">  &lt;div style=&#123;wrapperStyle&#125;&gt;</span><br><span class="line">    &lt;h3&gt;组件演示&lt;/h3&gt;</span><br><span class="line">    &#123;stroyFn()&#125;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line">addDecorator(storyWrapper)</span><br><span class="line">addDecorator(withInfo)</span><br><span class="line">addParameters(&#123;info: &#123; inline: true, header: false&#125;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const loaderFn = () =&gt; &#123;</span><br><span class="line">    const allExports = [];</span><br><span class="line">    const req = require.context(&apos;../src/components&apos;, true, /\.stories\.tsx$/);</span><br><span class="line">    req.keys().forEach(fname =&gt; allExports.push(req(fname)));</span><br><span class="line">    return allExports;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">configure(loaderFn, module);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol start="6">
<li>在每个组件目录下面新建一个<code>.stories.tsx</code>结尾的文件</li>
</ol>
<ul>
<li>button组件下新建<code>button.stories.tsx</code>文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import &#123; storiesOf &#125; from &apos;@storybook/react&apos;;</span><br><span class="line">import &#123; action &#125; from &apos;@storybook/addon-actions&apos;;</span><br><span class="line"></span><br><span class="line">import Button from &apos;./button&apos;</span><br><span class="line"></span><br><span class="line">const defaultButton = () =&gt; (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Button onClick=&#123;action(&apos;default button&apos;)&#125;&gt;default button&lt;/Button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">const buttonWithSize = () =&gt; (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Button size=&apos;lg&apos; btnType=&apos;primary&apos; onClick=&#123;action(&apos;lg button&apos;)&#125;&gt;lg button&lt;/Button&gt;</span><br><span class="line">        &lt;Button className=&apos;ml-20&apos; size=&apos;sm&apos; btnType=&apos;danger&apos; onClick=&#123;action(&apos;sm button&apos;)&#125;&gt;sm button&lt;/Button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const buttonWithType = () =&gt; (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Button onClick=&#123;action(&apos;danger button&apos;)&#125; btnType=&apos;danger&apos;&gt;danger button&lt;/Button&gt;</span><br><span class="line">        &lt;Button onClick=&#123;action(&apos;primary button&apos;)&#125; className=&apos;ml-20&apos; btnType=&apos;primary&apos;&gt;primary button&lt;/Button&gt;</span><br><span class="line">        &lt;Button onClick=&#123;action(&apos;link&apos;)&#125; className=&apos;ml-20&apos; btnType=&apos;link&apos; href=&apos;https://www.baidu.com/&apos;&gt;link&lt;/Button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">const buttonWithDisabled = () =&gt; (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Button onClick=&#123;action(&apos;disabled button&apos;)&#125; btnType=&apos;danger&apos; disabled=&#123;true&#125;&gt;disabled button&lt;/Button&gt;</span><br><span class="line">        &lt;Button onClick=&#123;action(&apos;unDisabled button&apos;)&#125; className=&apos;ml-20&apos; btnType=&apos;primary&apos;&gt;unDisabled button&lt;/Button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// storiesOf(&apos;Button组件&apos;, module)</span><br><span class="line">// .addDecorator(withInfo)</span><br><span class="line">// .addParameters(&#123;</span><br><span class="line">//     info:&#123;</span><br><span class="line">//         text:`</span><br><span class="line">//         这是默认组件</span><br><span class="line">//         ~~~js</span><br><span class="line">//         const a = 12</span><br><span class="line">//         ~~~</span><br><span class="line">//         `,</span><br><span class="line">//         inline:true</span><br><span class="line">//     &#125;</span><br><span class="line">// &#125;)</span><br><span class="line">//   .add(&apos;默认 Button&apos;, defaultButton)</span><br><span class="line">//   .add(&apos;不同尺寸 Button&apos;, buttonWithSize,&#123;info:&#123;inline:false&#125;&#125;)</span><br><span class="line">//   .add(&apos;不同类型 Button&apos;, buttonWithType)</span><br><span class="line"></span><br><span class="line">storiesOf(&apos;Button 按钮&apos;, module)</span><br><span class="line">    .addParameters(&#123;</span><br><span class="line">        info: &#123;</span><br><span class="line">            text: `</span><br><span class="line">        ## 引用方法</span><br><span class="line">        ~~~js</span><br><span class="line">        import &#123;Button&#125; from ecoh-rui</span><br><span class="line">        ~~~</span><br><span class="line">        `</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .add(&apos;默认 Button&apos;, defaultButton)</span><br><span class="line">    .add(&apos;不同尺寸 Button&apos;, buttonWithSize)</span><br><span class="line">    .add(&apos;不同类型 Button&apos;, buttonWithType)</span><br><span class="line">    .add(&apos;禁用的 Button&apos;,buttonWithDisabled)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>7.执行命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run storybook</span><br></pre></td></tr></table></figure></p>
<p>在终端可以看到<br><img src="https://upload-images.jianshu.io/upload_images/11846892-8b43e51f15d70e6b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>浏览器打开<code>http://localhost:9009/</code>,可以看到组件库文档生成了。<br><img src="https://upload-images.jianshu.io/upload_images/11846892-151907d5b1ed9637.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h2 id="十、-typescript编译配置"><a href="#十、-typescript编译配置" class="headerlink" title="十、 typescript编译配置"></a>十、 typescript编译配置</h2><p>新建<code>tsconfig.build.json</code>文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;compilerOptions&quot;: &#123;</span><br><span class="line">    // 输出路径</span><br><span class="line">    &quot;outDir&quot;: &quot;dist&quot;,</span><br><span class="line">    // 打包模块规范</span><br><span class="line">    &quot;module&quot;: &quot;esnext&quot;,</span><br><span class="line">    // 构建目标</span><br><span class="line">    &quot;target&quot;: &quot;es5&quot;,</span><br><span class="line">    // 生成定义文件d.ts</span><br><span class="line">    &quot;declaration&quot;: true,</span><br><span class="line">    &quot;jsx&quot;: &quot;react&quot;,</span><br><span class="line">    // 模块引入策略</span><br><span class="line">    &quot;moduleResolution&quot;: &quot;Node&quot;,</span><br><span class="line">    // 允许import React from &apos;react&apos;这样导包</span><br><span class="line">    &quot;allowSyntheticDefaultImports&quot;: true</span><br><span class="line">  &#125;,</span><br><span class="line">  // 需要编译的目录</span><br><span class="line">  &quot;include&quot;: [&quot;src&quot;],</span><br><span class="line">  // 不需要编译的</span><br><span class="line">  &quot;exclude&quot;: [&quot;src/**/*.test.tsx&quot;, &quot;src/**/*.stories.tsx&quot;, &quot;src/setupTests.ts&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="十一、-package-json相关配置"><a href="#十一、-package-json相关配置" class="headerlink" title="十一、 package.json相关配置"></a>十一、 package.json相关配置</h2><ul>
<li><p>将依赖包从dependencies搬到devDependencie</p>
<blockquote>
<p>为什么要这么做？<br>一、是防止发布组件库之后别人使用了跟我们不一样的react版本造成冲突<br>二、是我们在开发的时候还需要使用到react和react-dom，所以不能删除，只能搬到devDependencies<br>三、还有一些跟发布后的组件库不相关的依赖都需要搬到devDependencies，例如storybook等</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 嘿嘿，移动之后，发现为空了，重新install 了一下</span><br><span class="line">// 运行了npm start 和npm run test 和npm run storybook发现一切正常，开心一下！！</span><br><span class="line">&quot;dependencies&quot;: &#123;&#125;,</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>添加npm发布相关配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&quot;description&quot;: &quot;react components library&quot;,</span><br><span class="line">&quot;author&quot;: &quot;echo&quot;,</span><br><span class="line">&quot;private&quot;: false,</span><br><span class="line">// 主入口</span><br><span class="line">&quot;main&quot;: &quot;dist/index.js&quot;,</span><br><span class="line">// 模块入口</span><br><span class="line">&quot;module&quot;: &quot;dist/index.js&quot;,</span><br><span class="line">// 类型文件声明</span><br><span class="line">&quot;types&quot;: &quot;dist/index.d.ts&quot;,</span><br><span class="line">&quot;license&quot;: &quot;MIT&quot;,</span><br><span class="line">// 关键词</span><br><span class="line">&quot;keywords&quot;: [</span><br><span class="line">    &quot;React&quot;,</span><br><span class="line">    &quot;UI&quot;,</span><br><span class="line">    &quot;Component&quot;,</span><br><span class="line">    &quot;typescript&quot;</span><br><span class="line">  ],</span><br><span class="line">// 首页你的github地址</span><br><span class="line">  &quot;homepage&quot;: &quot;https://github.com/.../echo-rui&quot;,</span><br><span class="line">// 仓库地址</span><br><span class="line">  &quot;repository&quot;: &#123;</span><br><span class="line">    &quot;type&quot;: &quot;git&quot;,</span><br><span class="line">    &quot;url&quot;: &quot;https://github.com/.../echo-ruii&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 需要上传的文件，不写就默认以.gitignore为准</span><br><span class="line">  &quot;files&quot;: [</span><br><span class="line">    &quot;dist&quot;</span><br><span class="line">  ],</span><br></pre></td></tr></table></figure>
</li>
<li><p>代码提交git前检查。这里使用husky这个工具</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&quot;husky&quot;: &#123;</span><br><span class="line">    &quot;hooks&quot;: &#123;</span><br><span class="line">    // 用git提交代码之前</span><br><span class="line">      &quot;pre-commit&quot;: &quot;npm run test:nowatch &amp;&amp; npm run lint&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">   ...</span><br><span class="line">    &quot;lint&quot;: &quot;eslint --ext js,ts,tsx src --fix --max-warnings 5&quot;,</span><br><span class="line">    &quot;test:nowatch&quot;: &quot;cross-env CI=true react-scripts test&quot;,</span><br><span class="line">   ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加打包发布相关配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">   ...</span><br><span class="line">    &quot;clean&quot;: &quot;rimraf ./dist&quot;,</span><br><span class="line">    &quot;build-ts&quot;: &quot;tsc -p tsconfig.build.json&quot;,</span><br><span class="line">    &quot;build-css&quot;: &quot;node-sass ./src/styles/index.scss ./dist/index.css&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;npm run clean &amp;&amp; npm run build-ts &amp;&amp; npm run build-css &amp;&amp; node ./buildScss.js&quot;,</span><br><span class="line">    &quot;prepublishOnly&quot;: &quot;npm run lint &amp;&amp; npm run build&quot;</span><br><span class="line">  </span><br><span class="line">   ...</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>此时执行打包命令，就可以成功根据配置打包了。</p>
<h2 id="十二、-发布到npm"><a href="#十二、-发布到npm" class="headerlink" title="十二、 发布到npm"></a>十二、 发布到npm</h2><p>万事俱备，只欠发布。</p>
<ul>
<li>完善一下 README.md 文档，这个随便写两句就好</li>
<li>在根目录下新建一个 .npmignore 文件，内容和 .gitignore 差不多<br>最后执行 npm login 登入 npm 账号，再执行 npm publish 发布即可，就这么简单的两步就可以，过一会在 npm 上就能搜到了。当然前提是你有个 npm 账号，没有的话去注册一个吧，很 easy 的，然后还要搜下你的 npm 包名是否有人用，有的话就换一个。</li>
</ul>
<p>总结：大功告成✌️✌️✌️✌️✌️✌️✌️✌️✌️✌️✌️✌️✌️✌️✌️✌️✌️✌️✌️✌️</p>

        </div>

        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/React/"># React</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2020/07/01/Node3/">NO1:使用 Node.js + Express 开发服务端</a>
            
            
            <a class="next" rel="next" href="/2020/05/01/React3/">使用react搭建组件库--radio组件</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Echo | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
